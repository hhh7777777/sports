<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{common/admin-layout :: adminPage(
    currentPage='dashboard',
    admin=${admin},
    content=~{::content},
    additionalScripts=~{::scripts}
)">
    <th:block th:fragment="content">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">仪表板</h1>
        </div>

        <!-- 统计卡片 -->
        <div class="row" th:if="${stats != null}">
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-primary shadow h-100 py-2 stat-card">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                    总用户数
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalUsers" th:text="${stats.totalUsers}">0</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-users fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-success shadow h-100 py-2 stat-card">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                    今日活跃
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" id="activeToday" th:text="${stats.activeToday}">0</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-chart-line fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-info shadow h-100 py-2 stat-card">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                    运动记录
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalRecords" th:text="${stats.totalRecords}">0</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-running fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-warning shadow h-100 py-2 stat-card">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                    徽章总数
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalBadges" th:text="${stats.totalBadges}">0</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-trophy fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 图表区域 -->
        <div class="row">
            <div class="col-lg-8 mb-4">
                <div class="card shadow">
                    <div class="card-header">
                        <h6 class="m-0 font-weight-bold text-primary">用户增长趋势</h6>
                    </div>
                    <div class="card-body">
                        <canvas id="userGrowthChart" height="100"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 mb-4">
                <div class="card shadow">
                    <div class="card-header">
                        <h6 class="m-0 font-weight-bold text-primary">运动类型分布</h6>
                    </div>
                    <div class="card-body">
                        <canvas id="activityTypeChart" height="200"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- 最新活动和活跃度排行 -->
        <div class="row">
            <div class="col-lg-6 mb-4">
                <div class="card shadow">
                    <div class="card-header">
                        <h6 class="m-0 font-weight-bold text-primary">最新活动</h6>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered" id="recentActivities">
                                <thead>
                                <tr>
                                    <th>用户</th>
                                    <th>活动类型</th>
                                    <th>时长(分钟)</th>
                                    <th>时间</th>
                                </tr>
                                </thead>
                                <tbody>
                                    <tr th:if="${recentActivities == null or recentActivities.empty}">
                                        <td colspan="4" class="text-center">暂无数据</td>
                                    </tr>
                                    <tr th:each="activity : ${recentActivities}">
                                        <td th:text="${activity.userName ?: activity.userId ?: '未知用户'}">用户</td>
                                        <td th:text="${activity.typeName ?: '未知类型'}">活动类型</td>
                                        <td th:text="${activity.duration ?: 0}">时长</td>
                                        <td th:text="${activity.createTime != null ? #temporals.format(activity.createTime, 'yyyy-MM-dd HH:mm') : '未知时间'}">时间</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 mb-4">
                <div class="card shadow">
                    <div class="card-header">
                        <h6 class="m-0 font-weight-bold text-primary">活跃度排行</h6>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered" id="activityRank">
                                <thead>
                                <tr>
                                    <th>排名</th>
                                    <th>用户</th>
                                    <th>总时长(分钟)</th>
                                </tr>
                                </thead>
                                <tbody>
                                    <tr th:if="${activityRank == null or activityRank.empty}">
                                        <td colspan="3" class="text-center">暂无数据</td>
                                    </tr>
                                    <tr th:each="rank, iterStat : ${activityRank}">
                                        <td>
                                            <span class="badge" th:classappend="${iterStat.index < 3 ? 'bg-danger' : 'bg-secondary'}" th:text="${iterStat.index + 1}">排名</span>
                                        </td>
                                        <td th:text="${rank['nickname'] ?: rank['username'] ?: rank['userId'] ?: '未知用户'}">用户</td>
                                        <td th:text="${rank['totalDuration'] ?: 0} + ' 分钟'">总时长</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </th:block>
    <th:block th:fragment="scripts">
        <script src="/libs/chartjs/chart.min.js"></script>
        <script src="/js/admin/admin-dashboard.js"></script>
    </th:block>
</th:block>
</html>