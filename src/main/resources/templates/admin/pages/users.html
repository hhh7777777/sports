<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{common/admin-layout :: adminPage(
    currentPage='users',
    admin=${admin},
    content=~{::content},
    additionalScripts=~{::scripts}
)">
    <th:block th:fragment="content">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">用户管理</h1>
            <div class="btn-toolbar mb-2 mb-md-0">
                <div class="btn-group me-2">
                    <button type="button" class="btn btn-sm btn-outline-secondary">分享</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary">导出</button>
                </div>
                <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle">
                    <i class="fas fa-download me-1"></i>新建
                </button>
            </div>
        </div>

        <!-- 用户搜索和筛选 -->
        <div class="row mb-3">
            <div class="col-md-3">
                <input type="text" class="form-control" id="searchInput" placeholder="搜索用户名/邮箱">
            </div>
            <div class="col-md-2">
                <select class="form-select" id="statusFilter">
                    <option value="">全部状态</option>
                    <option value="ACTIVE">活跃</option>
                    <option value="INACTIVE">非活跃</option>
                    <option value="BANNED">已禁用</option>
                </select>
            </div>
            <div class="col-md-2">
                <button class="btn btn-primary" id="searchBtn">搜索</button>
            </div>
        </div>

        <!-- 用户表格 -->
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>用户名</th>
                        <th>邮箱</th>
                        <th>注册时间</th>
                        <th>最后登录</th>
                        <th>状态</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="userTableBody">
                    <tr th:if="${users == null or #lists.isEmpty(users)}">
                        <td colspan="7" class="text-center">暂无用户数据</td>
                    </tr>
                    <tr th:each="user : ${users}">
                        <td th:text="${user.id}">1</td>
                        <td th:text="${user.username}">username</td>
                        <td th:text="${user.email}">email@example.com</td>
                        <td th:text="${user.createTime != null ? #temporals.format(user.createTime, 'yyyy-MM-dd HH:mm') : 'N/A'}">2024-01-01 10:00</td>
                        <td th:text="${user.lastLoginTime != null ? #temporals.format(user.lastLoginTime, 'yyyy-MM-dd HH:mm') : 'N/A'}">2024-01-01 10:00</td>
                        <td>
                            <span class="badge bg-success" th:if="${user.status == 'ACTIVE'}">活跃</span>
                            <span class="badge bg-warning" th:if="${user.status == 'INACTIVE'}">非活跃</span>
                            <span class="badge bg-danger" th:if="${user.status == 'BANNED'}">已禁用</span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary edit-user" th:data-userid="${user.id}">编辑</button>
                            <button class="btn btn-sm btn-outline-warning reset-password" th:data-userid="${user.id}">重置密码</button>
                            <button class="btn btn-sm btn-outline-danger toggle-status" th:data-userid="${user.id}" th:data-status="${user.status}">禁用</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- 分页 -->
        <nav aria-label="用户列表分页" th:if="${pagination != null}">
            <ul class="pagination justify-content-center">
                <li class="page-item" th:classappend="${pagination.currentPage == 1} ? 'disabled'">
                    <a class="page-link" th:href="@{'/admin/users?page=' + ${pagination.currentPage - 1}}">上一页</a>
                </li>
                <li class="page-item" th:each="i : ${#numbers.sequence(pagination.startPage, pagination.endPage)}" th:classappend="${i == pagination.currentPage} ? 'active'">
                    <a class="page-link" th:href="@{'/admin/users?page=' + ${i}}" th:text="${i}">1</a>
                </li>
                <li class="page-item" th:classappend="${pagination.currentPage == pagination.totalPages} ? 'disabled'">
                    <a class="page-link" th:href="@{'/admin/users?page=' + ${pagination.currentPage + 1}}">下一页</a>
                </li>
            </ul>
        </nav>
        <nav th:unless="${pagination != null}">
            <ul class="pagination justify-content-center">
                <li class="page-item disabled">
                    <a class="page-link" href="#">暂无分页</a>
                </li>
            </ul>
        </nav>
    </th:block>
    <th:block th:fragment="scripts">
        <script src="/js/admin/admin-users.js"></script>
    </th:block>
</th:block>
</html>