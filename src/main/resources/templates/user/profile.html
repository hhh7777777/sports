1<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人资料 - 运动健康管理系统</title>
    <link href="/libs/bootstrap/5.3.0/bootstrap.min.css" rel="stylesheet">
    <link href="/libs/fontawesome/6.0.0/all.min.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">
</head>
<body>
<!-- 导航栏 -->
<th:block th:include="common/base :: user-nav"></th:block>

<div class="container-fluid">
    <div class="row">
        <!-- 侧边栏 -->
        <nav class="col-md-3 col-lg-2 d-md-block sidebar">
            <div class="position-sticky pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="/dashboard">
                            <i class="fas fa-tachometer-alt"></i>仪表板
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/behavior">
                            <i class="fas fa-running"></i>运动记录
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/achievements">
                            <i class="fas fa-trophy"></i>成就徽章
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/profile">
                            <i class="fas fa-user"></i>个人资料
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- 主内容区 -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">个人资料</h1>
            </div>

            <div class="row">
                <div class="col-lg-8">
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">基本信息</h5>
                        </div>
                        <div class="card-body">
                            <form id="profileForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="username" class="form-label">用户名</label>
                                        <input type="text" class="form-control" id="username" name="username" readonly>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="email" class="form-label">邮箱</label>
                                        <input type="email" class="form-control" id="email" name="email">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="nickname" class="form-label">昵称</label>
                                        <input type="text" class="form-control" id="nickname" name="nickname">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="gender" class="form-label">性别</label>
                                        <select class="form-select" id="gender" name="gender">
                                            <option value="">请选择</option>
                                            <option value="MALE">男</option>
                                            <option value="FEMALE">女</option>
                                            <option value="OTHER">其他</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="birthday" class="form-label">生日</label>
                                        <input type="date" class="form-control" id="birthday" name="birthday">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="registerDate" class="form-label">注册时间</label>
                                        <input type="text" class="form-control" id="registerDate" name="registerDate" readonly>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="height" class="form-label">身高 (cm)</label>
                                        <input type="number" class="form-control" id="height" name="height" min="1" max="300">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="weight" class="form-label">体重 (kg)</label>
                                        <input type="number" class="form-control" id="weight" name="weight" min="1" max="500" step="0.1">
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">更新资料</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">头像</h5>
                        </div>
                        <div class="card-body text-center">
                            <img src="/images/avatar/avatar.png" alt="头像" class="rounded-circle mb-3" id="profileImage" style="width: 150px; height: 150px; object-fit: cover;">
                            <div class="mb-3">
                                <button class="btn btn-outline-primary" id="changeAvatarBtn">更换头像</button>
                                <input type="file" id="avatarInput" class="d-none" accept="image/*">
                            </div>
                            <button class="btn btn-outline-warning" id="changePasswordBtn">修改密码</button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">统计信息</h5>
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-6 stat-item">
                                    <div class="stat-number" id="totalDuration">0</div>
                                    <div class="stat-label">总运动时长(分钟)</div>
                                </div>
                                <div class="col-6 stat-item">
                                    <div class="stat-number" id="totalRecords">0</div>
                                    <div class="stat-label">运动记录数</div>
                                </div>
                                <div class="col-6 stat-item">
                                    <div class="stat-number" id="achievementCount">0</div>
                                    <div class="stat-label">成就数</div>
                                </div>
                                <div class="col-6 stat-item">
                                    <div class="stat-number" id="streakDays">0</div>
                                    <div class="stat-label">连续天数</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- 修改密码模态框 -->
<div class="modal fade" id="changePasswordModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">修改密码</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="passwordForm">
                    <div class="mb-3">
                        <label for="currentPassword" class="form-label">当前密码</label>
                        <input type="password" class="form-control" id="currentPassword" required>
                    </div>
                    <div class="mb-3">
                        <label for="newPassword" class="form-label">新密码</label>
                        <input type="password" class="form-control" id="newPassword" required>
                        <div class="password-strength mt-2">
                            <div class="progress">
                                <div class="progress-bar" id="passwordStrengthBar" role="progressbar" style="width: 0%"></div>
                            </div>
                            <small class="text-muted" id="passwordStrengthText">密码强度</small>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="confirmNewPassword" class="form-label">确认新密码</label>
                        <input type="password" class="form-control" id="confirmNewPassword" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="savePasswordBtn">保存</button>
            </div>
        </div>
    </div>
</div>

<script src="/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="/libs/bootstrap/5.3.0/bootstrap.bundle.min.js"></script>
<script src="/js/user/profile.js"></script>
<script>
    // 页面加载完成后初始化
    $(document).ready(function() {
        // 检查用户登录状态
        AuthUtils.checkAuth();
    });
</script>
</body>
</html>